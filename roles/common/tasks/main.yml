---
- name: Update apt cache
  apt: update_cache=yes
  tags:
    - dependencies

- name: Upgrade all safe packages
  apt: upgrade=safe
  tags:
    - dependencies

- name: Install necessities and nice-to-haves
  apt: pkg={{ item }} state=present
  with_items:
    - apt-transport-https
    - apticron
    - debian-goodies
    - git
    - htop
    - molly-guard
    - mosh
    - python3-software-properties
    - sudo
    - unattended-upgrades
    - vim
    - tmux
  tags:
    - dependencies

- name: timezone - configure /etc/timezone
  copy:
    content: "{{ common_timezone | regex_replace('$', '\n') }}"
    dest: /etc/timezone
    owner: root
    group: root
    mode: 0644
  register: common_timezone_config

- name: timezone - Set localtime to UTC
  file: src=/usr/share/zoneinfo/Etc/UTC dest=/etc/localtime
  when: common_timezone_config.changed
  tags:
    - skip_ansible_lint

- name: timezone - reconfigure tzdata
  command: dpkg-reconfigure --frontend noninteractive tzdata
  when: common_timezone_config.changed
  tags:
    - skip_ansible_lint

- name: Global gitconfig with aliases
  template: src=etc_gitconfig.j2 dest=/etc/gitconfig

#- name: Create decrypted directory (even if encfs isn't used)
#  file: state=directory path=/decrypted

#- name: Set decrypted directory permissions
#  file: state=directory path=/decrypted group=mail mode=0775

- name: Ensure locale en_US.UTF-8 locale is present
  locale_gen:
    name: en_US.UTF-8
    state: present

#- import_tasks: encfs.yml
#  tags: encfs
- import_tasks: users.yml
  tags: users
#- import_tasks: ufw.yml
#  tags: ufw
- import_tasks: firewalld.yml
  tags: firewalld
- import_tasks: security.yml
  tags: security
- import_tasks: ntp.yml
  tags: ntp
